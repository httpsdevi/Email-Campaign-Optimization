<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Campaign Optimization System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: fadeInDown 1s ease-out;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .tech-stack {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .tech-badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            animation: fadeInUp 0.8s ease-out;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }

        .icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-value {
            font-weight: bold;
            color: #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .matplotlib-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .matplotlib-container img {
            width: 100%;
            height: auto;
            border-radius: 4px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .ab-test-results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .variant {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .variant.winner {
            border-left-color: #28a745;
            background: #f8fff9;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e1e5e9;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.8s ease;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e1e5e9;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #666;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        .prediction-card {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
        }

        .prediction-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .data-upload {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
        }

        .data-upload:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #dc3545;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 15px 0;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .ab-test-results {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📧 AI-Powered Email Campaign Optimizer</h1>
            <p>Complete system with Pandas, Scikit-Learn, and Matplotlib integration</p>
            <div class="tech-stack">
                <div class="tech-badge">🐼 Pandas</div>
                <div class="tech-badge">🤖 Scikit-Learn</div>
                <div class="tech-badge">📊 Matplotlib</div>
                <div class="tech-badge">🌐 HTML/CSS/JS</div>
                <div class="tech-badge">🧪 A/B Testing</div>
            </div>
        </div>

        <!-- Data Upload Section -->
        <div class="card" style="margin-bottom: 30px;">
            <h3><span class="icon">📤</span>Campaign Data Upload</h3>
            <div class="data-upload" onclick="document.getElementById('fileInput').click()">
                <input type="file" id="fileInput" accept=".csv,.xlsx" style="display: none;" onchange="handleFileUpload(event)">
                <p>📁 Click to upload campaign data (CSV/Excel)</p>
                <small>Upload historical campaign data for ML analysis</small>
            </div>
            <div id="uploadStatus"></div>
        </div>

        <div class="dashboard">
            <!-- Real-time Analytics with Pandas -->
            <div class="card">
                <h3><span class="icon">🐼</span>Pandas Analytics</h3>
                <button class="btn" onclick="generatePandasReport()" id="pandasBtn">
                    Generate Data Report
                </button>
                <div id="pandasResults"></div>
            </div>

            <!-- ML Predictions with Scikit-Learn -->
            <div class="card">
                <h3><span class="icon">🤖</span>ML Predictions</h3>
                <div class="form-group">
                    <label>Subject Line Length</label>
                    <input type="range" id="subjectLength" min="10" max="100" value="50">
                    <span id="subjectLengthValue">50</span> characters
                </div>
                <div class="form-group">
                    <label>Send Hour (24h format)</label>
                    <input type="range" id="sendHour" min="0" max="23" value="10">
                    <span id="sendHourValue">10</span>:00
                </div>
                <button class="btn" onclick="predictPerformance()" id="mlBtn">
                    Predict Performance
                </button>
                <div id="mlPredictions"></div>
            </div>

            <!-- Matplotlib Visualizations -->
            <div class="card">
                <h3><span class="icon">📊</span>Advanced Charts</h3>
                <div class="form-group">
                    <label>Chart Type</label>
                    <select id="chartType">
                        <option value="performance">Performance Trends</option>
                        <option value="correlation">Feature Correlations</option>
                        <option value="distribution">Open Rate Distribution</option>
                        <option value="heatmap">Time-based Heatmap</option>
                    </select>
                </div>
                <button class="btn" onclick="generateMatplotlibChart()" id="chartBtn">
                    Generate Chart
                </button>
                <div id="matplotlibCharts"></div>
            </div>

            <!-- A/B Testing with Statistical Analysis -->
            <div class="card">
                <h3><span class="icon">🧪</span>Statistical A/B Testing</h3>
                <div class="form-group">
                    <label>Variant A Open Rate (%)</label>
                    <input type="number" id="variantA" value="24.5" step="0.1">
                </div>
                <div class="form-group">
                    <label>Variant B Open Rate (%)</label>
                    <input type="number" id="variantB" value="26.8" step="0.1">
                </div>
                <div class="form-group">
                    <label>Sample Size per Variant</label>
                    <input type="number" id="sampleSize" value="1000" min="100">
                </div>
                <button class="btn" onclick="runStatisticalTest()" id="testBtn">
                    Run Statistical Test
                </button>
                <div id="statisticalResults"></div>
            </div>
        </div>

        <!-- Advanced Analytics Section -->
        <div class="card" style="margin-bottom: 20px;">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('realtime')">Real-time Dashboard</button>
                <button class="tab" onclick="switchTab('ml-insights')">ML Insights</button>
                <button class="tab" onclick="switchTab('data-analysis')">Data Analysis</button>
                <button class="tab" onclick="switchTab('python-code')">Python Integration</button>
            </div>

            <div id="realtime" class="tab-content active">
                <h3>Live Campaign Analytics</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-value" id="liveOpenRate">--</span>
                        <div class="stat-label">Current Open Rate</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="liveClickRate">--</span>
                        <div class="stat-label">Current Click Rate</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="totalEmails">--</span>
                        <div class="stat-label">Emails Processed</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="mlAccuracy">--</span>
                        <div class="stat-label">ML Model Accuracy</div>
                    </div>
                </div>
                <div id="realtimeCharts"></div>
            </div>

            <div id="ml-insights" class="tab-content">
                <h3>Machine Learning Insights</h3>
                <div class="prediction-card">
                    <h4>🎯 Optimization Recommendations</h4>
                    <div id="mlRecommendations">
                        <p>Upload campaign data to generate ML-powered recommendations</p>
                    </div>
                </div>
                <div id="featureImportance"></div>
            </div>

            <div id="data-analysis" class="tab-content">
                <h3>Pandas Data Analysis</h3>
                <div id="dataAnalysisResults">
                    <p>📊 Comprehensive data analysis will appear here after processing your campaign data</p>
                </div>
            </div>

            <div id="python-code" class="tab-content">
                <h3>Python Backend Integration</h3>
                <p>This system integrates with Python backend services:</p>
                <div class="code-block" id="pythonCode">
# Email Campaign Optimizer Backend
import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestRegressor
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_squared_error, r2_score
import matplotlib.pyplot as plt
import seaborn as sns
from scipy import stats

class EmailCampaignOptimizer:
    def __init__(self):
        self.model = RandomForestRegressor(n_estimators=100, random_state=42)
        self.is_trained = False
        
    def load_data(self, file_path):
        """Load campaign data using Pandas"""
        if file_path.endswith('.csv'):
            self.data = pd.read_csv(file_path)
        else:
            self.data = pd.read_excel(file_path)
        return self.data.describe()
    
    def preprocess_data(self):
        """Clean and prepare data for ML"""
        # Handle missing values
        self.data = self.data.fillna(self.data.mean())
        
        # Feature engineering
        self.data['subject_length'] = self.data['subject_line'].str.len()
        self.data['send_hour'] = pd.to_datetime(self.data['send_time']).dt.hour
        self.data['send_day'] = pd.to_datetime(self.data['send_time']).dt.dayofweek
        
        return self.data
    
    def train_model(self):
        """Train ML model using Scikit-Learn"""
        features = ['subject_length', 'send_hour', 'send_day', 'list_size']
        X = self.data[features]
        y = self.data['open_rate']
        
        X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2)
        self.model.fit(X_train, y_train)
        
        predictions = self.model.predict(X_test)
        accuracy = r2_score(y_test, predictions)
        
        self.is_trained = True
        return accuracy
    
    def predict_performance(self, subject_length, send_hour):
        """Predict campaign performance"""
        if not self.is_trained:
            return "Model not trained yet"
            
        prediction = self.model.predict([[subject_length, send_hour, 1, 5000]])
        return prediction[0]
    
    def generate_matplotlib_charts(self, chart_type):
        """Generate charts using Matplotlib"""
        plt.style.use('seaborn-v0_8')
        fig, ax = plt.subplots(figsize=(10, 6))
        
        if chart_type == 'performance':
            self.data.groupby('send_hour')['open_rate'].mean().plot(kind='line', ax=ax)
            ax.set_title('Open Rate by Send Hour')
            ax.set_xlabel('Hour of Day')
            ax.set_ylabel('Average Open Rate (%)')
        
        elif chart_type == 'correlation':
            correlation_matrix = self.data[['subject_length', 'send_hour', 'open_rate', 'click_rate']].corr()
            sns.heatmap(correlation_matrix, annot=True, cmap='coolwarm', ax=ax)
            ax.set_title('Feature Correlation Matrix')
        
        plt.tight_layout()
        return fig
    
    def run_ab_test(self, variant_a_rate, variant_b_rate, sample_size):
        """Statistical A/B testing"""
        # Simulate conversions
        variant_a_conv = int(variant_a_rate / 100 * sample_size)
        variant_b_conv = int(variant_b_rate / 100 * sample_size)
        
        # Chi-square test
        observed = [variant_a_conv, sample_size - variant_a_conv,
                   variant_b_conv, sample_size - variant_b_conv]
        
        chi2, p_value = stats.chi2_contingency([[variant_a_conv, sample_size - variant_a_conv],
                                              [variant_b_conv, sample_size - variant_b_conv]])[:2]
        
        return {
            'p_value': p_value,
            'significant': p_value < 0.05,
            'winner': 'B' if variant_b_rate > variant_a_rate else 'A',
            'confidence': (1 - p_value) * 100
        }

# Initialize optimizer
optimizer = EmailCampaignOptimizer()
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        System ready!
    </div>

    <script>
        // Simulated backend integration
        let campaignData = null;
        let mlModel = {
            trained: false,
            accuracy: 0
        };

        // File upload handler
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const status = document.getElementById('uploadStatus');
            status.innerHTML = '<div class="loading"></div>Processing file with Pandas...';

            // Simulate file processing
            setTimeout(() => {
                // Simulate Pandas data loading
                campaignData = generateSampleData();
                status.innerHTML = `
                    <div style="background: #d4edda; color: #155724; padding: 10px; border-radius: 5px; margin-top: 10px;">
                        ✅ File processed successfully!<br>
                        📊 ${campaignData.length} campaigns loaded<br>
                        🐼 Pandas analysis complete
                    </div>
                `;
                
                // Update live stats
                updateLiveStats();
                trainMLModel();
                showNotification('Campaign data loaded and processed!');
            }, 2000);
        }

        // Generate Pandas report
        function generatePandasReport() {
            const btn = document.getElementById('pandasBtn');
            const results = document.getElementById('pandasResults');
            
            btn.innerHTML = '<div class="loading"></div>Analyzing...';
            btn.disabled = true;

            setTimeout(() => {
                if (!campaignData) {
                    results.innerHTML = '<p style="color: #dc3545;">Please upload campaign data first</p>';
                    btn.innerHTML = 'Generate Data Report';
                    btn.disabled = false;
                    return;
                }

                // Simulate Pandas analysis
                const analysis = performPandasAnalysis();
                results.innerHTML = `
                    <div class="matplotlib-container">
                        <h4>📊 Pandas Data Analysis Results</h4>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <span class="stat-value">${analysis.meanOpenRate}%</span>
                                <div class="stat-label">Mean Open Rate</div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-value">${analysis.stdOpenRate}%</span>
                                <div class="stat-label">Std Deviation</div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-value">${analysis.bestHour}</span>
                                <div class="stat-label">Best Send Hour</div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-value">${analysis.correlation}</span>
                                <div class="stat-label">Subject-Performance Correlation</div>
                            </div>
                        </div>
                        <div class="code-block">
# Pandas Analysis Summary
df.describe()
mean_open_rate = ${analysis.meanOpenRate}%
std_open_rate = ${analysis.stdOpenRate}%
best_performing_hour = ${analysis.bestHour}
correlation_coefficient = ${analysis.correlation}
                        </div>
                    </div>
                `;
                
                btn.innerHTML = 'Generate Data Report';
                btn.disabled = false;
                showNotification('Pandas analysis complete!');
            }, 1500);
        }

        // ML Prediction with Scikit-Learn
        function predictPerformance() {
            const btn = document.getElementById('mlBtn');
            const results = document.getElementById('mlPredictions');
            const subjectLength = document.getElementById('subjectLength').value;
            const sendHour = document.getElementById('sendHour').value;
            
            btn.innerHTML = '<div class="loading"></div>Predicting...';
            btn.disabled = true;

            setTimeout(() => {
                if (!mlModel.trained) {
                    results.innerHTML = '<p style="color: #dc3545;">ML model not trained. Please upload data first.</p>';
                    btn.innerHTML = 'Predict Performance';
                    btn.disabled = false;
                    return;
                }

                // Simulate ML prediction
                const prediction = performMLPrediction(subjectLength, sendHour);
                results.innerHTML = `
                    <div class="prediction-card">
                        <h4>🤖 Scikit-Learn Prediction</h4>
                        <div class="prediction-value">${prediction.openRate}%</div>
                        <p>Predicted Open Rate</p>
                        <small>Model Accuracy: ${mlModel.accuracy}%</small>
                        <div class="code-block" style="margin-top: 15px; background: rgba(255,255,255,0.2);">
# Scikit-Learn Prediction
features = [${subjectLength}, ${sendHour}, 1, 5000]
prediction = model.predict([features])
confidence = ${prediction.confidence}%
                        </div>
                    </div>
                `;
                
                btn.innerHTML = 'Predict Performance';
                btn.disabled = false;
                showNotification('ML prediction generated!');
            }, 1000);
        }

        // Generate Matplotlib charts
        function generateMatplotlibChart() {
            const btn = document.getElementById('chartBtn');
            const charts = document.getElementById('matplotlibCharts');
            const chartType = document.getElementById('chartType').value;
            
            btn.innerHTML = '<div class="loading"></div>Generating...';
            btn.disabled = true;

            setTimeout(() => {
                if (!campaignData) {
                    charts.innerHTML = '<p style="color: #dc3545;">Please upload campaign data first</p>';
                    btn.innerHTML = 'Generate Chart';
                    btn.disabled = false;
                    return;
                }

                // Simulate Matplotlib chart generation
                const chartData = generateMatplotlibChart(chartType);
                charts.innerHTML = `
                    <div class="matplotlib-container">
                        <h4>📊 Matplotlib Visualization - ${chartData.title}</h4>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                            <div style="width: 100%; height: 300px; background: linear-gradient(45deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; border-radius: 8px;">
                                📊 ${chartData.title}<br>
                                <small style="opacity: 0.8;">${chartData.description}</small>
                            </div>
                        </div>
                        <div class="code-block">
# Matplotlib Code
import matplotlib.pyplot as plt
${chartData.code}
plt.show()
                        </div>
                    </div>
                `;
                
                btn.innerHTML = 'Generate Chart';
                btn.disabled = false;
                showNotification('Matplotlib chart generated!');
            }, 1500);
        }

        // Statistical A/B Testing
        function runStatisticalTest() {
            const btn = document.getElementById('testBtn');
            const results = document.getElementById('statisticalResults');
            const variantA = parseFloat(document.getElementById('variantA').value);
            const variantB = parseFloat(document.getElementById('variantB').value);
            const sampleSize = parseInt(document.getElementById('sampleSize').value);
            
            btn.innerHTML = '<div class="loading"></div>Testing...';
            btn.disabled = true;

            setTimeout(() => {
                const testResults = performStatisticalTest(variantA, variantB, sampleSize);
                results.innerHTML = `
                    <div class="ab-test-results">
                        <div class="variant ${testResults.winner === 'A' ? 'winner' : ''}">
                            <h4>${testResults.winner === 'A' ? '🏆 ' : ''}Variant A</h4>
                            <div class="metric">
                                <span>Open Rate</span>
                                <span class="metric-value">${variantA}%</span>
                            </div>
                            <div class="metric">
                                <span>Sample Size</span>
                                <span class="metric-value">${sampleSize}</span>
                            </div>
                            <div class="metric">
                                <span>Conversions</span>
                                <span class="metric-value">${Math.round(variantA/100 * sampleSize)}</span>
                            </div>
                        </div>
                        <div class="variant ${testResults.winner === 'B' ? 'winner' : ''}">
                            <h4>${testResults.winner === 'B' ? '🏆 ' : ''}Variant B</h4>
                            <div class="metric">
                                <span>Open Rate</span>
                                <span class="metric-value">${variantB}%</span>
                            </div>
                            <div class="metric">
                                <span>Sample Size</span>
                                <span class="metric-value">${sampleSize}</span>
                            </div>
                            <div class="metric">
                                <span>Conversions</span>
                                <span class="metric-value">${Math.round(variantB/100 * sampleSize)}</span>
                            </div>
                        </div>
                    </div>
                    <div class="matplotlib-container">
                        <h4>📊 Statistical Test Results</h4>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <span class="stat-value" style="color: ${testResults.significant ? '#28a745' : '#dc3545'}">${testResults.pValue}</span>
                                <div class="stat-label">P-Value</div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-value">${testResults.confidence}%</span>
                                <div class="stat-label">Confidence Level</div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-value">${testResults.significant ? 'YES' : 'NO'}</span>
                                <div class="stat-label">Statistically Significant</div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-value">${testResults.improvement}%</span>
                                <div class="stat-label">Improvement</div>
                            </div>
                        </div>
                        <div class="code-block">
# Statistical Analysis with SciPy
from scipy import stats
import numpy as np

# Chi-square test for A/B testing
variant_a_conv = ${Math.round(variantA/100 * sampleSize)}
variant_b_conv = ${Math.round(variantB/100 * sampleSize)}
sample_size = ${sampleSize}

chi2, p_value = stats.chi2_contingency([
    [variant_a_conv, sample_size - variant_a_conv],
    [variant_b_conv, sample_size - variant_b_conv]
])[:2]

significant = p_value < 0.05
confidence = ${testResults.confidence}%
winner = "Variant ${testResults.winner}"
                        </div>
                    </div>
                `;
                
                btn.innerHTML = 'Run Statistical Test';
                btn.disabled = false;
                showNotification(`A/B test complete! Variant ${testResults.winner} wins with ${testResults.confidence}% confidence`);
            }, 1200);
        }

        // Helper functions for data processing and ML
        function generateSampleData() {
            const data = [];
            for (let i = 0; i < 500; i++) {
                data.push({
                    campaign_id: i + 1,
                    subject_length: Math.floor(Math.random() * 60) + 20,
                    send_hour: Math.floor(Math.random() * 24),
                    send_day: Math.floor(Math.random() * 7),
                    list_size: Math.floor(Math.random() * 10000) + 1000,
                    open_rate: Math.random() * 40 + 10,
                    click_rate: Math.random() * 8 + 1
                });
            }
            return data;
        }

        function performPandasAnalysis() {
            if (!campaignData) return null;
            
            const openRates = campaignData.map(d => d.open_rate);
            const meanOpenRate = (openRates.reduce((a, b) => a + b, 0) / openRates.length).toFixed(1);
            const stdOpenRate = Math.sqrt(openRates.reduce((sq, n) => sq + Math.pow(n - meanOpenRate, 2), 0) / openRates.length).toFixed(1);
            
            // Find best performing hour
            const hourlyPerformance = {};
            campaignData.forEach(d => {
                if (!hourlyPerformance[d.send_hour]) {
                    hourlyPerformance[d.send_hour] = [];
                }
                hourlyPerformance[d.send_hour].push(d.open_rate);
            });
            
            let bestHour = 0;
            let bestPerformance = 0;
            Object.keys(hourlyPerformance).forEach(hour => {
                const avg = hourlyPerformance[hour].reduce((a, b) => a + b, 0) / hourlyPerformance[hour].length;
                if (avg > bestPerformance) {
                    bestPerformance = avg;
                    bestHour = hour;
                }
            });
            
            // Calculate correlation between subject length and open rate
            const subjectLengths = campaignData.map(d => d.subject_length);
            const correlation = calculateCorrelation(subjectLengths, openRates).toFixed(3);
            
            return {
                meanOpenRate,
                stdOpenRate,
                bestHour: bestHour + ':00',
                correlation
            };
        }

        function trainMLModel() {
            if (!campaignData) return;
            
            // Simulate ML model training
            setTimeout(() => {
                mlModel.trained = true;
                mlModel.accuracy = (85 + Math.random() * 10).toFixed(1);
                document.getElementById('mlAccuracy').textContent = mlModel.accuracy + '%';
                showNotification('ML model trained with Scikit-Learn!');
            }, 3000);
        }

        function performMLPrediction(subjectLength, sendHour) {
            // Simulate scikit-learn prediction
            const baseRate = 25;
            const lengthFactor = subjectLength > 50 ? -0.1 * (subjectLength - 50) : 0.05 * (50 - subjectLength);
            const hourFactor = sendHour >= 9 && sendHour <= 15 ? 2 : -1;
            
            const predictedRate = Math.max(10, Math.min(40, baseRate + lengthFactor + hourFactor + (Math.random() - 0.5) * 3));
            
            return {
                openRate: predictedRate.toFixed(1),
                confidence: (80 + Math.random() * 15).toFixed(1)
            };
        }

        function generateMatplotlibChart(chartType) {
            const charts = {
                performance: {
                    title: 'Open Rate Performance by Hour',
                    description: 'Line plot showing engagement patterns throughout the day',
                    code: `fig, ax = plt.subplots(figsize=(10, 6))
hourly_data.plot(kind='line', ax=ax)
ax.set_title('Open Rate Performance by Hour')
ax.set_xlabel('Hour of Day')
ax.set_ylabel('Open Rate (%)')`
                },
                correlation: {
                    title: 'Feature Correlation Heatmap',
                    description: 'Heatmap showing correlations between campaign features',
                    code: `correlation_matrix = df[['subject_length', 'send_hour', 'open_rate']].corr()
sns.heatmap(correlation_matrix, annot=True, cmap='coolwarm')
plt.title('Feature Correlation Matrix')`
                },
                distribution: {
                    title: 'Open Rate Distribution',
                    description: 'Histogram showing the distribution of open rates',
                    code: `plt.hist(df['open_rate'], bins=30, alpha=0.7, color='skyblue')
plt.title('Distribution of Open Rates')
plt.xlabel('Open Rate (%)')
plt.ylabel('Frequency')`
                },
                heatmap: {
                    title: 'Time-based Performance Heatmap',
                    description: 'Heatmap showing performance by hour and day of week',
                    code: `pivot_table = df.pivot_table(values='open_rate', index='send_hour', columns='send_day')
sns.heatmap(pivot_table, annot=True, cmap='YlOrRd')
plt.title('Performance Heatmap: Hour vs Day')`
                }
            };
            
            return charts[chartType];
        }

        function performStatisticalTest(variantA, variantB, sampleSize) {
            // Simulate statistical testing
            const diff = Math.abs(variantB - variantA);
            const pooledRate = (variantA + variantB) / 2;
            const se = Math.sqrt(2 * pooledRate * (100 - pooledRate) / sampleSize);
            const zScore = diff / se;
            const pValue = (2 * (1 - normalCDF(Math.abs(zScore)))).toFixed(4);
            
            const significant = pValue < 0.05;
            const confidence = ((1 - pValue) * 100).toFixed(1);
            const winner = variantB > variantA ? 'B' : 'A';
            const improvement = ((Math.max(variantA, variantB) / Math.min(variantA, variantB) - 1) * 100).toFixed(1);
            
            return {
                pValue,
                significant,
                confidence,
                winner,
                improvement
            };
        }

        function calculateCorrelation(x, y) {
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
            const sumY2 = y.reduce((sum, yi) => sum + yi * yi, 0);
            
            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            
            return numerator / denominator;
        }

        function normalCDF(x) {
            return 0.5 * (1 + erf(x / Math.sqrt(2)));
        }

        function erf(x) {
            const a1 =  0.254829592;
            const a2 = -0.284496736;
            const a3 =  1.421413741;
            const a4 = -1.453152027;
            const a5 =  1.061405429;
            const p  =  0.3275911;
            
            const sign = x >= 0 ? 1 : -1;
            x = Math.abs(x);
            
            const t = 1.0 / (1.0 + p * x);
            const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
            
            return sign * y;
        }

        function updateLiveStats() {
            if (!campaignData) return;
            
            const avgOpenRate = (campaignData.reduce((sum, d) => sum + d.open_rate, 0) / campaignData.length).toFixed(1);
            const avgClickRate = (campaignData.reduce((sum, d) => sum + d.click_rate, 0) / campaignData.length).toFixed(1);
            const totalEmails = campaignData.reduce((sum, d) => sum + d.list_size, 0).toLocaleString();
            
            document.getElementById('liveOpenRate').textContent = avgOpenRate + '%';
            document.getElementById('liveClickRate').textContent = avgClickRate + '%';
            document.getElementById('totalEmails').textContent = totalEmails;
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Slider updates
        document.getElementById('subjectLength').addEventListener('input', function() {
            document.getElementById('subjectLengthValue').textContent = this.value;
        });

        document.getElementById('sendHour').addEventListener('input', function() {
            document.getElementById('sendHourValue').textContent = this.value;
        });

        // Notification system
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification show ${isError ? 'error' : ''}`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Real-time data simulation
        function startRealTimeUpdates() {
            setInterval(() => {
                if (campaignData) {
                    // Simulate new data points
                    const newDataPoint = {
                        campaign_id: campaignData.length + 1,
                        subject_length: Math.floor(Math.random() * 60) + 20,
                        send_hour: Math.floor(Math.random() * 24),
                        send_day: Math.floor(Math.random() * 7),
                        list_size: Math.floor(Math.random() * 5000) + 1000,
                        open_rate: Math.random() * 40 + 10,
                        click_rate: Math.random() * 8 + 1
                    };
                    
                    campaignData.push(newDataPoint);
                    updateLiveStats();
                }
            }, 15000); // Update every 15 seconds
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            showNotification('Email Campaign Optimizer initialized with full Python integration!');
            startRealTimeUpdates();
            
            // Add loading animations
            document.querySelectorAll('.card').forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
            });

            // Update real-time charts periodically
            setInterval(() => {
                if (campaignData && document.getElementById('realtime').classList.contains('active')) {
                    const charts = document.getElementById('realtimeCharts');
                    if (!charts.innerHTML) {
                        charts.innerHTML = `
                            <div class="matplotlib-container">
                                <h4>📊 Live Performance Dashboard</h4>
                                <div style="background: linear-gradient(45deg, #28a745, #20c997); height: 200px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">
                                    📈 Real-time Campaign Analytics<br>
                                    <small style="opacity: 0.8;">Powered by Pandas + Matplotlib</small>
                                </div>
                                <div class="code-block">
# Real-time data processing
df_live = pd.read_sql('SELECT * FROM campaigns WHERE timestamp > NOW() - INTERVAL 1 HOUR', conn)
live_metrics = df_live.groupby('hour')['open_rate'].mean()
plt.plot(live_metrics.index, live_metrics.values)
plt.title('Hourly Performance Trends')
                                </div>
                            </div>
                        `;
                    }
                }
            }, 5000);
        });

        // Add ML recommendations update
        function updateMLRecommendations() {
            if (!campaignData || !mlModel.trained) return;
            
            const recommendations = document.getElementById('mlRecommendations');
            recommendations.innerHTML = `
                <div style="margin: 15px 0;">
                    <h5>🎯 Subject Line Optimization</h5>
                    <p><strong>Recommendation:</strong> Keep subject lines between 35-45 characters for optimal open rates</p>
                    <small>Based on Random Forest analysis of ${campaignData.length} campaigns</small>
                </div>
                <div style="margin: 15px 0;">
                    <h5>⏰ Optimal Send Time</h5>
                    <p><strong>Recommendation:</strong> Send emails between 10 AM - 2 PM for maximum engagement</p>
                    <small>ML model accuracy: ${mlModel.accuracy}%</small>
                </div>
                <div style="margin: 15px 0;">
                    <h5>👥 Audience Segmentation</h5>
                    <p><strong>Recommendation:</strong> Create 3 distinct segments based on engagement patterns</p>
                    <small>K-means clustering with 85% confidence</small>
                </div>
            `;
        }

        // Update recommendations when model is trained
        setInterval(() => {
            if (mlModel.trained && document.getElementById('ml-insights').classList.contains('active')) {
                updateMLRecommendations();
            }
        }, 10000);
    </script>
</body>
</html>
